<%- include("layouts/left") %>

<div>
  <% if((locals.user && !locals.notLoginUser ) || (locals.user && locals.notLoginUser && locals.user.id == notLoginUser.id) ) { %>
  <div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingOne">
        <button
          class="accordion-button"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#panelsStayOpen-collapseOne"
          aria-expanded="true"
          aria-controls="panelsStayOpen-collapseOne"
        >
          Edit profile
        </button>
      </h2>
      <div
        id="panelsStayOpen-collapseOne"
        class="accordion-collapse collapse show"
        aria-labelledby="panelsStayOpen-headingOne"
      >
        <div class="accordion-body">
          <div class="col-6 m-auto">
            <form
              action="/user/<%= locals?.user?.id %>/update"
              method="post"
              enctype="multipart/form-data"
            >
              <input type="hidden" name="_method" value="PUT" />
              <div class="mb-3">
                <div class="preview mt-2">
                  <img
                    src="<%= locals?.user?.avatar %>"
                    alt=""
                    width="100px"
                    height="100px"
                  />
                </div>
                <label class="mt-1" for="avatar">Profile image</label>
                <input
                  type="file"
                  name="avatar"
                  id="avatar"
                  class="form-control"
                  accept="image/*"
                />
              </div>
              <div class="mb-3">
                <label for="first_name">First name</label>
                <input
                  type="text"
                  name="first_name"
                  id="first_name"
                  class="form-control <%= locals?.oldInput?.first_name?.message ? "is-invalid" : ""%>"
                  value="<%= locals?.oldInput?.first_name? locals?.oldInput?.first_name.value : locals?.user?.first_name%>"
                />
                <div class="invalid-feedback">
                  <%=locals?.oldInput?.first_name?.message%>
                </div>
              </div>
              <div class="mb-3">
                <label for="last_name">Last name</label>
                <input
                  type="text"
                  name="last_name"
                  id="last_name"
                  class="form-control <%= locals?.oldInput?.last_name?.message ? "is-invalid" : ""%>"
                  value="<%= locals?.oldInput?.last_name ? locals?.oldInput?.last_name.value : locals?.user?.last_name%>"
                />
                <div class="invalid-feedback">
                  <%=locals?.oldInput?.last_name?.message%>
                </div>
              </div>
              <div class="mb-3">
                <button
                  type="submit"
                  class="btn btn-sm btn-primary form-control"
                >
                  Update
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#panelsStayOpen-collapseTwo"
          aria-expanded="false"
          aria-controls="panelsStayOpen-collapseTwo"
        >
          Change password
        </button>
      </h2>
      <div
        id="panelsStayOpen-collapseTwo"
        class="accordion-collapse collapse <%= locals?.oldInput?.password ? "show" : "" %>"
        aria-labelledby="panelsStayOpen-headingTwo"
      >
        <div class="accordion-body">
          <div class="col-6 m-auto">
            <form action="/user/<%= locals?.user?.id%>/change" method="post">
              <input type="hidden" name="_method" value="PUT" />
              <div class="mb-3">
                <label for="old_password">Old password</label>
                <input type="password" name="old_password" id="old_password"
                class="form-control <%= locals?.oldInput?.old_password?.message
                ? "is-invalid" :"" %>" />
                <div class="invalid-feedback">
                  <%= locals?.oldInput?.old_password?.message%>
                </div>
              </div>
              <div class="mb-3">
                <label for="password">New password</label>
                <input type="password" name="password" id="password"
                class="form-control <%= locals?.oldInput?.password?.message ?
                "is-invalid" :"" %>" />
                <div class="invalid-feedback">
                  <%= locals?.oldInput?.password?.message%>
                </div>
              </div>
              <div class="mb-3">
                <label for="confirm">Confirm password</label>
                <input type="password" name="confirm" id="confirm"
                class="form-control <%= locals?.oldInput?.confirm?.message ?
                "is-invalid" :"" %>" />
                <div class="invalid-feedback">
                  <%= locals?.oldInput?.confirm?.message%>
                </div>
              </div>
              <div class="mb-3">
                <button
                  type="submit"
                  class="btn btn-sm btn-primary form-control"
                >
                  Change
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <% } else { %>
      <div class="card col-8 m-auto">
        <img src="<%= notLoginUser?.avatar %>" style="width: 320px;" class="card-img-top m-auto mt-3" alt="...">
        <div class="card-body">
          <table class="table table-bordered">
            <tr>
              <td>Name</td>
              <td><%= notLoginUser?.name %></td>              
            </tr>
            <tr>
              <td>Email</td>
              <td><%= notLoginUser?.email %></td>
            </tr>
            <tr>
              <td>CreatedAt</td>
              <td><%= notLoginUser?.createdAt %></td>
            </tr>
          </table>
        </div>
      </div>
      <% } %>
  </div>

  <script>
    let avatar = document.querySelector("#avatar");
    let preveiw = document.querySelector(".preview img");
    if(avatar){
      avatar.addEventListener("change", (e) => {
      let file = e.target.files[0];
      preveiw.src = URL.createObjectURL(file);
    });
    }
  </script>
</div>
<%- include("layouts/right") %>
